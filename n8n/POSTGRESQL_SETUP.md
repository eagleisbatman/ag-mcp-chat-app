# PostgreSQL Setup for n8n on Railway

## ü§î What is PostgreSQL for?

**PostgreSQL is OPTIONAL** - n8n works fine without it!

**Without PostgreSQL (Default):**
- ‚úÖ n8n stores workflows in **file system** (SQLite)
- ‚úÖ Works perfectly for single-instance deployments
- ‚úÖ Simpler setup
- ‚ö†Ô∏è Data lost if container restarts (unless using persistent volumes)

**With PostgreSQL:**
- ‚úÖ Workflows stored in **database** (more reliable)
- ‚úÖ Better for **production** deployments
- ‚úÖ Data persists even if container restarts
- ‚úÖ Can scale to multiple n8n instances
- ‚úÖ Better performance for large workflows

---

## üöÄ Setup on Railway (EASY!)

Railway makes this super simple - you don't need to manually configure connection strings!

### Step 1: Add PostgreSQL Service

1. **Railway Dashboard** ‚Üí Your Project (`ag-mcp-app`)
2. Click **"New"** ‚Üí **"Database"** ‚Üí **"Add PostgreSQL"**
3. Railway automatically creates:
   - PostgreSQL database
   - Connection credentials
   - **Automatic environment variables** üéâ

### Step 2: Railway Auto-Connects!

Railway **automatically** creates these environment variables for your n8n service:

```
POSTGRES_HOST=postgres.railway.internal
POSTGRES_PORT=5432
POSTGRES_DATABASE=railway
POSTGRES_USER=postgres
POSTGRES_PASSWORD=<auto-generated>
POSTGRES_URL=postgresql://postgres:password@postgres.railway.internal:5432/railway
```

**These are automatically available to your n8n service!** ‚ú®

### Step 3: Configure n8n to Use PostgreSQL

Add these environment variables to your **n8n service** (not PostgreSQL service):

**Go to:** Railway Dashboard ‚Üí Your n8n Service ‚Üí **Variables** tab

**Add these variables:**

```
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=${{Postgres.POSTGRES_HOST}}
DB_POSTGRESDB_PORT=${{Postgres.POSTGRES_PORT}}
DB_POSTGRESDB_DATABASE=${{Postgres.POSTGRES_DATABASE}}
DB_POSTGRESDB_USER=${{Postgres.POSTGRES_USER}}
DB_POSTGRESDB_PASSWORD=${{Postgres.POSTGRES_PASSWORD}}
DB_POSTGRESDB_SCHEMA=public
```

**OR use Railway's reference syntax:**

```
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=${{Postgres.POSTGRES_HOST}}
DB_POSTGRESDB_PORT=${{Postgres.POSTGRES_PORT}}
DB_POSTGRESDB_DATABASE=${{Postgres.POSTGRES_DATABASE}}
DB_POSTGRESDB_USER=${{Postgres.POSTGRES_USER}}
DB_POSTGRESDB_PASSWORD=${{Postgres.POSTGRES_PASSWORD}}
DB_POSTGRESDB_SCHEMA=public
```

**Railway Reference Syntax:**
- `${{Postgres.POSTGRES_HOST}}` - References the PostgreSQL service's host
- Railway automatically resolves these when services are linked

---

## üìã Step-by-Step Guide

### Option A: Using Railway's Reference Variables (Recommended)

1. **Add PostgreSQL:**
   - Railway Dashboard ‚Üí Project ‚Üí **"New"** ‚Üí **"Database"** ‚Üí **"Add PostgreSQL"**
   - Railway creates PostgreSQL service automatically

2. **Link Services:**
   - Railway automatically links services in the same project
   - Or manually: n8n Service ‚Üí **Settings** ‚Üí **"Generate Domain"** ‚Üí Link PostgreSQL

3. **Add Variables to n8n Service:**
   ```
   DB_TYPE=postgresdb
   DB_POSTGRESDB_HOST=${{Postgres.POSTGRES_HOST}}
   DB_POSTGRESDB_PORT=${{Postgres.POSTGRES_PORT}}
   DB_POSTGRESDB_DATABASE=${{Postgres.POSTGRES_DATABASE}}
   DB_POSTGRESDB_USER=${{Postgres.POSTGRES_USER}}
   DB_POSTGRESDB_PASSWORD=${{Postgres.POSTGRES_PASSWORD}}
   DB_POSTGRESDB_SCHEMA=public
   ```

4. **Redeploy n8n:**
   - Railway will restart n8n with PostgreSQL connection
   - n8n will automatically create tables on first startup

### Option B: Manual Configuration (If Railway references don't work)

1. **Add PostgreSQL Service** (same as above)

2. **Get Connection Details:**
   - Railway Dashboard ‚Üí PostgreSQL Service ‚Üí **Variables** tab
   - Copy these values:
     - `POSTGRES_HOST`
     - `POSTGRES_PORT`
     - `POSTGRES_DATABASE`
     - `POSTGRES_USER`
     - `POSTGRES_PASSWORD`

3. **Add to n8n Service Variables:**
   ```
   DB_TYPE=postgresdb
   DB_POSTGRESDB_HOST=<paste-POSTGRES_HOST>
   DB_POSTGRESDB_PORT=<paste-POSTGRES_PORT>
   DB_POSTGRESDB_DATABASE=<paste-POSTGRES_DATABASE>
   DB_POSTGRESDB_USER=<paste-POSTGRES_USER>
   DB_POSTGRESDB_PASSWORD=<paste-POSTGRES_PASSWORD>
   DB_POSTGRESDB_SCHEMA=public
   ```

---

## ‚úÖ Verify It's Working

1. **Check n8n Logs:**
   - Railway Dashboard ‚Üí n8n Service ‚Üí **Deployments** ‚Üí **View Logs**
   - Look for: `"Database connection established"` or similar

2. **Check n8n UI:**
   - Access: `https://ag-mcp-app.up.railway.app`
   - Create a workflow
   - If it saves, PostgreSQL is working! ‚úÖ

3. **Check PostgreSQL:**
   - Railway Dashboard ‚Üí PostgreSQL Service ‚Üí **Data** tab
   - You should see tables like `workflow_entity`, `execution_entity`, etc.

---

## üö´ Do I Need PostgreSQL?

**You DON'T need PostgreSQL if:**
- ‚úÖ This is a **development/test** deployment
- ‚úÖ You're okay with **file-based storage** (SQLite)
- ‚úÖ You want **simpler setup**
- ‚úÖ Single instance deployment

**You SHOULD use PostgreSQL if:**
- ‚úÖ **Production** deployment
- ‚úÖ Need **data persistence** across restarts
- ‚úÖ Planning to **scale** to multiple instances
- ‚úÖ Need **better performance** with many workflows

---

## üìù Summary

**Railway makes PostgreSQL setup EASY:**

1. ‚úÖ Add PostgreSQL service (Railway creates it)
2. ‚úÖ Railway provides connection variables automatically
3. ‚úÖ Add DB variables to n8n service (use `${{Postgres.*}}` references)
4. ‚úÖ n8n automatically connects and creates tables

**No manual connection string configuration needed!** Railway handles it all! üéâ

---

## üîó Useful Links

- **Railway PostgreSQL Docs:** https://docs.railway.app/databases/postgresql
- **n8n PostgreSQL Docs:** https://docs.n8n.io/hosting/configuration/database/postgresdb/
- **Railway Reference Variables:** https://docs.railway.app/variables/reference-variables

