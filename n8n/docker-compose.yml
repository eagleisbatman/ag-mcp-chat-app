# Docker Compose configuration for n8n
# Based on official n8n documentation: https://docs.n8n.io/hosting/installation/docker/
#
# Usage:
#   docker compose up -d
#   docker compose down

version: '3.8'

services:
  n8n:
    image: docker.n8n.io/n8nio/n8n:latest
    container_name: n8n
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      # Required
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-change-me-please}
      - WEBHOOK_URL=${WEBHOOK_URL:-http://localhost:5678}
      - GENERIC_TIMEZONE=${GENERIC_TIMEZONE:-UTC}
      - TZ=${TZ:-UTC}
      
      # Recommended (from official docs)
      - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true
      - N8N_RUNNERS_ENABLED=true
      
      # Optional: PostgreSQL (uncomment if using PostgreSQL)
      # - DB_TYPE=postgresdb
      # - DB_POSTGRESDB_DATABASE=${POSTGRES_DATABASE:-n8n}
      # - DB_POSTGRESDB_HOST=${POSTGRES_HOST:-postgres}
      # - DB_POSTGRESDB_PORT=${POSTGRES_PORT:-5432}
      # - DB_POSTGRESDB_USER=${POSTGRES_USER:-n8n}
      # - DB_POSTGRESDB_SCHEMA=${POSTGRES_SCHEMA:-public}
      # - DB_POSTGRESDB_PASSWORD=${POSTGRES_PASSWORD:-change-me}
      
      # Optional: Basic Auth
      # - N8N_BASIC_AUTH_ACTIVE=true
      # - N8N_BASIC_AUTH_USER=${N8N_BASIC_AUTH_USER:-admin}
      # - N8N_BASIC_AUTH_PASSWORD=${N8N_BASIC_AUTH_PASSWORD:-change-me}
      
      # Your custom variables
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
    volumes:
      - n8n_data:/home/node/.n8n
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:5678/healthz', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Optional: PostgreSQL service (uncomment if using PostgreSQL)
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: n8n_postgres
  #   restart: unless-stopped
  #   environment:
  #     - POSTGRES_DB=${POSTGRES_DATABASE:-n8n}
  #     - POSTGRES_USER=${POSTGRES_USER:-n8n}
  #     - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-change-me}
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data

volumes:
  n8n_data:
    driver: local
  # postgres_data:
  #   driver: local

